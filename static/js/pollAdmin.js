// Generated by CoffeeScript 1.6.2
(function() {
  define('pollAdmin', ['jquery', 'underscore'], function($, _) {
    /*
      JQUERY SETUP
    */

    var getParticipantForm, init_key, json_data, json_data_string, poll_key;

    json_data_string = $('#json-data').html();
    json_data = JSON.parse(json_data_string);
    poll_key = json_data['poll_key'];
    init_key = json_data['init_key'];
    $('form#admin-add').submit(function(event) {
      var ajax_settings, part_list, promise;

      part_list = getParticipantForm($(this).find('fieldset'));
      console.log(part_list);
      ajax_settings = {
        type: 'POST',
        url: '/' + poll_key + '/participants?key=' + init_key,
        contentType: 'application/json',
        data: JSON.stringify(part_list)
      };
      console.log(ajax_settings);
      promise = $.ajax(ajax_settings);
      promise.done(function(data) {
        return $('#content').prepend('<p id=\'status-msg\'>Participants Added</p>');
      });
      promise.fail(function(jqXHR, textStatus, errorThrown) {
        throw new Error(errorThrown);
      });
      return false;
    });
    /*
      HELPER FUNCTIONS
    */

    getParticipantForm = function(form_selector) {
      /*
        TODO
      */

      var part_list, part_string, part_textarea;

      part_textarea = $(form_selector).find('textarea');
      part_string = $(part_textarea).val();
      return part_list = part_string.split(/[\s\n,]+/);
    };
    return null;
  });

}).call(this);
